<p id="notice"><%= notice %></p>
<section class="content-header">
  <div class="text-center">
    <h1 class="page-title">Review for <%= @individual_review.employee.profile.name %> on <%= @individual_review.date %></h1>
    
  </div>
</section>	

<div class="content">	
	<div class="row">
		<div class="col-md-6">
			<div class="box box-primary">
				<div class="box-body">
					<p>
					  <strong>Date:</strong>
					  <%= @individual_review.date %><br>
					  <strong>Employee:</strong>
					  <%= @individual_review.employee.profile.name %><br>
					  <strong>Reviewer:</strong>
					  <%= @individual_review.reviewer.profile.name %><br>
					  <strong>Employee Title:</strong>
					  <%= @individual_review.employee.profile.job_title %><br>
					</p>
				</div>
			</div>
		</div>
	</div>

	<%= link_to "Update this review", edit_individual_review_path(@individual_review), class:"btn btn-flat btn-primary" %>
	<br><br>

	<div class="row">
		<div class="col-md-8">		
			<div class="box box-primary">
				<div class="box-header">
					<h3>Results</h3>
				</div>
				<div class="box-body">
					<table class="table table-bordered">
						<tbody>
							<th>key</th>
							<th>value</th>
							<th>percentage</th>
							<th></th>	
							<% @check_results.each do |key, value|%>
								<tr>
									<td><%= key %></td> 
									<td><%= value %></td> 
									<td>
										<% percentage = ((value.to_f / @total_check_questions.to_f) * 100).round(0) %>
										<div class="progress progress-xs">
											<div class="progress-bar progress-bar" style='width: <%= percentage %>%'></div>
										</div>
									</td>
									<td>
										<span class="badge bg-light-blue">% <%= percentage.round(0)%></span>	
									</td>
								</tr>
							<% end %>
						</tbody>
					</table>
				</div>
			</div>
		</div>
	</div>


	<h2>Results</h2>
	<% @results.select('answers.*, questions.section_id').group_by(&:section_id).each_with_index do |(section, answers), i| %>
		<div class="box box-solid collapsed-box">
			<div class="box-header bg-<%= @color_array[i] %> with-border">
				<h4 class='box-title'><%= Section.find(section).title %></h4>
				<div class="box-tools pull-right">
				  <button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip" title="Collapse">
				    <i class="fa fa-plus"></i></button>
				</div>
			</div>
			<!-- this is to get Active Record relation of Answers instead of array -->
			<% array = answers.map(&:id) %>
			<% these_answers = Answer.where(id: array) %>
			<!-- end -->
			<div class="box-body">
				
				<% these_answers.joins(:question).select('answers.*, questions.subsection').group_by(&:subsection).each do |subsection, texts| %>
						<h3><%= subsection %></h3>
						<% texts.each do |text| %>
							<p><strong><em><%= text.question.question_text %></em></strong></p>
							<p class="answer"><%= text.answer %></p>
						<% end %>
						<hr>
				<% end %>
				<% section_answer = SectionAnswer.find_by(section_id: section, individual_review_id: @individual_review.id) %>
				<h4>Employee Comment</h4>
				<p><%= section_answer.employee_comment %></p>
				<h4>Reviewer Comment</h4>
				<p><%= section_answer.reviewer_comment %></p>
				<hr>
			</div>
		</div>
	<% end %>

	<%= link_to 'Edit', edit_individual_review_path(@individual_review) %> |
	<%= link_to 'Back', individual_reviews_path %>
</div>

<script>

  var AdminLTEOptions = {
    //Enable sidebar expand on hover effect for sidebar mini
    //This option is forced to true if both the fixed layout and sidebar mini
    //are used together
    sidebarExpandOnHover: true,
    //BoxRefresh Plugin
    enableBoxRefresh: true,
    //Bootstrap.js tooltip
    enableBSToppltip: true,
    //Box Widget Plugin. Enable this plugin
    //to allow boxes to be collapsed and/or removed
    enableBoxWidget: true,
    //Box Widget plugin options
    boxWidgetOptions: {
      boxWidgetIcons: {
        //Collapse icon
        collapse: 'fa-minus',
        //Open icon
        open: 'fa-plus',
        //Remove icon
        remove: 'fa-times'
      },
      boxWidgetSelectors: {
        //Remove button selector
        remove: '[data-widget="remove"]',
        //Collapse button selector
        collapse: '[data-widget="collapse"]'
      }
    },
  };

</script>
